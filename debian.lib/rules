#!/usr/bin/make -f

# This option brings dpkg-buildflags with LTO, which breaks the fat runtime builds
#export DEB_BUILD_MAINT_OPTIONS = hardening=+all

export DEB_CFLAGS_MAINT_STRIP = "-flto=auto -ffat-lto-objects"
export DEB_CXXFLAGS_MAINT_STRIP = "-flto=auto -ffat-lto-objects"
export DEB_CPPFLAGS_MAINT_STRIP = "-flto=auto -ffat-lto-objects"
export DEB_LDFLAGS_MAINT_STRIP = "-flto=auto -ffat-lto-objects"
export DEB_OBJCFLAGS_MAINT_STRIP = "-flto=auto -ffat-lto-objects"
export DEB_OBJCXXFLAGS_MAINT_STRIP = "-flto=auto -ffat-lto-objects"

include /usr/share/dpkg/buildflags.mk

%:
	dh $@ --buildsystem=cmake

override_dh_auto_test:
	dh_auto_test --buildsystem=cmake

override_dh_auto_configure:
	dh_auto_configure -- \
		-DBUILD_STATIC_AND_SHARED=1 \
		-DCMAKE_BUILD_TYPE=RelWithDebInfo \
		-DBUILD_AVX512=on \
		-DBUILD_AVX512VBMI=on \
		-DTEST_XDPSCAN=ON

override_dh_missing:
	dh_missing --fail-missing
